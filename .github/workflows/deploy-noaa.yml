name: Deploy NOAA

on:
  workflow_dispatch:
  # push:
  #   branches: [ main, dev, production ]
  # pull_request:
  #   branches: [ main, dev, production ]

jobs:
  deploy-dev:
    if: github.ref == 'refs/heads/dev'
  
    permissions:
      id-token: write
      contents: read

    runs-on: ubuntu-latest
    steps:
      
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v4
        with:
          sparse-checkout: 'noaa-cpfp-point/'
          sparse-checkout-cone-mode: false

      - name: ConfigureAWS Credentials 
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: arn:aws:iam::597746869805:role/ghgc-dashboard-role
          role-session-name: ${{ github.repository_owner}}
          aws-region: us-west-2
      
      - name: Upload to S3
        run: |
          aws s3 cp "./noaa-cpfp-point" s3://ghgc-dashboard-develop/custom-interfaces/noaa-cpfp-point/ --recursive

  deploy-staging:
    if: github.ref == 'refs/heads/main'
  
    permissions:
      id-token: write
      contents: read

    runs-on: ubuntu-latest
    steps:
      
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v4
        with:
          sparse-checkout: 'noaa-cpfp-point/'
          sparse-checkout-cone-mode: false

      - name: ConfigureAWS Credentials 
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: arn:aws:iam::944032361616:role/ghgc-dashboard-role
          role-session-name: ${{ github.repository_owner}}
          aws-region: us-west-2
      
      - name: Upload to S3
        run: |
          aws s3 cp "./noaa-cpfp-point" s3://ghgc-dashboard-develop/custom-interfaces/noaa-cpfp-point/ --recursive
  
  deploy-production:
    if: github.ref == 'refs/heads/production'
  
    permissions:
      id-token: write
      contents: read

    runs-on: ubuntu-latest
    steps:
      
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v4
        with:
          sparse-checkout: 'noaa-cpfp-point/'
          sparse-checkout-cone-mode: false

      - name: ConfigureAWS Credentials 
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: arn:aws:iam::597746869805:role/ghgc-dashboard-role
          role-session-name: ${{ github.repository_owner}}
          aws-region: us-west-2
      
      - name: Upload to S3
        run: |
          aws s3 cp "./noaa-cpfp-point" s3://ghgc-dashboard-develop/custom-interfaces/noaa-cpfp-point/ --recursive
